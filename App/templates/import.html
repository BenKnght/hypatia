{% extends "index.html" %}
{% block title %}Import Data{% endblock %}
{% block head %}
{{ super() }}
<link rel="stylesheet" type="text/css" href="/static/bower_components/blueimp-file-upload/css/jquery.fileupload.css">
{% endblock %}
{% block content %}
<h2>Import data</h2>
<div id="status" class="alert alert-info hide" role="alert">...</div>
<form id="uploadForm">
    <div class="form-group">
        <span class="btn btn-success fileinput-button">
            <i class="glyphicon glyphicon-plus"></i>
            <span>Select file...</span>
            <!-- The file input field used as target for the file upload widget -->
            <input id="fileupload" type="file" name="file" data-url="/upload">
        </span>

        <p class="help-block">See below for supported format. Exo planets - Coming Soon!</p>
    </div>
    <button type="submit" id="uploadSubmitBtn" class="btn btn-default">Submit</button>
</form>

<h2>Supported Format</h2>
<pre>
    Star: hip=77783
    hd = 142245
    bd = B+15 2925
    Spec Type = K0
    Vmag = [ 7.6302]
    dist (pc) = 109.53
    RA/Dec = (238.23,15.43)
    Disk component: thin
    FeH 0.12 [Adamow et al. (2014)]
    OH 0.12 [Adamow et al. (2014)]
    MgH 0.11 [Adamow et al. (2014)]
    AlH 0.06 [Adamow et al. (2014)]
    CaH 0.13 [Adamow et al. (2014)]
    TiH 0.19 [Adamow et al. (2014)]
</pre>

<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser.js"></script>-->
<script type="text/javascript" src="/static/bower_components/jquery/dist/jquery.min.js"></script>
<!--<script type="text/javascript" src="/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>-->
<!-- file upload-->
<script src="/static/bower_components/blueimp-file-upload/js/vendor/jquery.ui.widget.js"></script>
<script src="/static/bower_components/blueimp-file-upload/js/jquery.iframe-transport.js"></script>
<script src="/static/bower_components/blueimp-file-upload/js/jquery.fileupload.js"></script>


<script type="text/javascript">
    $('#fileupload').fileupload({
        dataType: 'json',
        autoUpload: false,
        add: function (e, data) {
            $("#uploadSubmitBtn").click(function () {
                $(this).attr('disabled', true);
                data.submit();
                // IMPORTANT: The below clears the file properly. Form reset or any other approach did not work :(
                $("#fileupload").replaceWith('<input id="fileupload" type="file" name="file" data-url="/upload">')
            });
        },
        always: function (e, data) {
            if (!data.errorThrown)
                $("#status").removeClass('hide').text(`Imported ${data.files[0].name} (${data.files[0].size}B). `).append(`<a href="/log/${data.result.log}" target="_blank" class="alert-link">Download details of this import</a>`);
            else
                $("#status").removeClass('hide').text('Unable to import. Try to remember as much sequence of operations you have done and share it with the developer.')

            $("#uploadSubmitBtn").attr('disabled', false);
        }
    });
</script>
{% endblock %}